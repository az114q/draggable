!function(a){var c,d,b=function(){};b.prototype.checkIsTouch=function(){return"ontouchstart"in a||navigator.maxTouchPoints},b.prototype.hackRequestAnimationFrame=function(){if(a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,!a.requestAnimationFrame){var c=0;a.requestAnimationFrame=function(a){var b=(new Date).getTime(),d=Math.max(16-b-c,0),e=setTimeout(a,d);return c=b+d,e}}},b.prototype.hackTransform=function(){var a=document.documentElement;this.transformProperty="string"==typeof a.style.transform?"transform":"WebkitTransform"},b.prototype.hackEventListener=function(){document.addEventListener&&(this.eventListener=!0)},b.prototype.hackStyle=function(b){return a.getComputedStyle?a.getComputedStyle(b):b.currentStyle},c=function(a,b,c){this.options=b||{},this.options.elemString=a,this.options.callBackEvent=c,this.init()},d=c.prototype=new b,d.init=function(){this.setTargetDom(),this.hackEventListener(),this.eventListener||(this.options.backToPosition=!0),this.checkIsTouch()?this.elem.addEventListener("touchstart",this):this.eventListener?this.elem.addEventListener("mousedown",this):(this.bindAttach(),this.elem.attachEvent("onmousedown",this.b_mousedown)),this.options.cursorCancel||(this.elem.style.cursor="move")},d.setTargetDom=function(){this.elem=this.getDom(this.options.elemString),this.parentMove=this.getDom(this.options.parentMove),this.targetDom=this.parentMove||this.elem},d.getDom=function(a){return"string"==typeof a?document.querySelector(a):a},d.bindAttach=function(){var d,e,b=this,c=["mousedown","mousemove","mouseup"];for(d=0,e=c.length;e>d;d++)this["b_"+c[d]]=function(d){return function(){b.event=a.event,b[c[d]]()}}(d)},d.dragDown=function(){this.enable=!0,this.hackTransform(),this.addClassName(),this.setIndex(),this.style=this.hackStyle(this.targetDom),this.targetPosition=this.getPosition(this.style),this.startPoint=this.getCoordinate(),this.movePoint={x:0,y:0},this.setPositionProperty(),this.bindCallBackEvent(),this.render()},d.addClassName=function(){this.options.addClassName&&(this.elem.className+=" "+this.options.addClassName)},d.setIndex=function(){},d.getPosition=function(a){var b={};return b.x="auto"==a.left?0:parseInt(a.left,10),b.y="auto"==a.top?0:parseInt(a.top,10),this.options.backToPosition?b:b=this.addTransform(b)},d.addTransform=function(a){var c,d,b=this.style[this.transformProperty];return b&&"-1"!=b.indexOf("matrix")?(c="-1"==b.indexOf("matrix3d")?4:12,d=b.split(","),this.translateX=parseInt(d[c],10),this.translateY=parseInt(d[c+1],10),a.x+=this.translateX,a.y+=this.translateY,a):a},d.getCoordinate=function(){return this.eventListener?{x:this.event.pageX||this.event.touches&&this.event.touches[0].pageX||0,y:this.event.pageY||this.event.touches&&this.event.touches[0].pageY||0}:{x:this.event.clientX+document.documentElement.scrollLeft,y:this.event.clientY+document.documentElement.scrollTop}},d.setPositionProperty=function(){var a={fix:!0,absolute:!0,relative:!0};a[this.style.position]||(this.targetDom.style.position="relative"),this.targetDom.style.cssText+=";left:"+this.targetPosition.x+"px;top:"+this.targetPosition.y+"px;"},d.bindCallBackEvent=function(){var b=this.event.type,c={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend"]},d=c[b];this.handles=d,this.bindEvent(!0)},d.bindEvent=function(b){var e,c=this,d=this.handles;this.eventListener?(e=b?"addEventListener":"removeEventListener",d.forEach(function(b){a[e](b,c)})):(e=b?"attachEvent":"detachEvent",document[e]("onmousemove",this.b_mousemove),document[e]("onmouseup",this.b_mouseup))},d.render=function(){var a=this;this.hackRequestAnimationFrame(),this._render=function(){a.enable&&(a.setTransform(),requestAnimationFrame(a._render))},requestAnimationFrame(this._render)},d.setTransform=function(){if(this.options.backToPosition){var a="left:"+(this.movePoint.x+this.targetPosition.x)+"px;top:"+(this.movePoint.y+this.targetPosition.y)+"px;";this.targetDom.style.cssText+=";"+a}else this.targetDom.style[this.transformProperty]="translate3d("+this.movePoint.x+"px,"+this.movePoint.y+"px,"+"0)"},d.dragMove=function(){var a=this.getCoordinate(),b={x:a.x-this.startPoint.x,y:a.y-this.startPoint.y};b=this.setGrid(b),this.checkMove(b),this.movePoint.x="y"==this.options.axis?0:b.x,this.movePoint.y="x"==this.options.axis?0:b.y,this.options.callBackEvent()},d.checkMove=function(a){if(!b)var b=this.getDom(this.options.parentMove);a.y<0?b.offsetTop<=this.options.tops.min&&this.dragUp():b.offsetTop>=this.options.tops.max&&this.dragUp()},d.setGrid=function(a){var b,c;return this.options.grid?(b=this.options.grid,c={},c.x=b.x?Math.round(a.x/b.x)*b.x:a.x,c.y=b.y?Math.round(a.y/b.y)*b.y:a.y,c):a},d.dragUp=function(){this.enable=!1,this.removeClassName(),this.bindEvent(!1),this.options.callBackEvent(),this.resetIndex(),this.options.backToPosition||this.resetPosition()},d.removeClassName=function(){if(this.options.addClassName){var a=new RegExp("(?:^|\\s)"+this.options.addClassName+"(?:\\s|$)","g");this.elem.className=this.elem.className.replace(a,"")}},d.resetIndex=function(){},d.resetPosition=function(){this.endPoint={x:this.movePoint.x+this.targetPosition.x,y:this.movePoint.y+this.targetPosition.y},this.targetDom.style.cssText+=";left:"+this.endPoint.x+"px;top:"+this.endPoint.y+"px;transform:translate3d(0,0,0)"},d.touchstart=function(a){this.dragDown(a)},d.mousedown=function(){this.dragDown()},d.mousemove=function(){this.dragMove()},d.touchmove=function(){this.dragMove()},d.mouseup=function(){this.dragUp()},d.touchend=function(){this.dragUp()},d.handleEvent=function(a){this.event=a;var b=this.event.type;b&&this[b]()},a.Draggable=c}(window);
